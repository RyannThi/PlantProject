tkz_stage3_bg=Class(object)function tkz_stage3_bg:init()	--	background.init(self,false)	--resource	LoadImageFromFile('tkz_stage3_a','THlib\\background\\tkz_stage3\\stage3_a.png')	LoadImageFromFile('tkz_stage3_b','THlib\\background\\tkz_stage3\\stage3_b.png')	LoadImageFromFile('tkz_stage3_c','THlib\\background\\tkz_stage3\\stage3_c.png')	LoadImageFromFile('tkz_stage3_d','THlib\\background\\tkz_stage3\\stage3_d.png')	--set 3d camera and fog	Set3D('eye',0,10.80,-8.40)	Set3D('at',0,-1.20,-4.90)	Set3D('up',0,1,0)	Set3D('z',2,23.50)	Set3D('fovy',0.60)	Set3D('fog',6.00,22.70,Color(200,50,0,170))	--	self.speed=0.02	self._z=0	task.New(self, function()			--- BG Movement 1			do				local _beg_x=0 local x=_beg_x  local _w_x=-90 local _end_x=0 local _d_w_x=180/(190-1)				local _beg_y=10.80 local y=_beg_y  local _w_y=-90 local _end_y=7.40 local _d_w_y=180/(190-1)				local _beg_z=-8.40 local z=_beg_z local _end_z=-11.20 local _w_z=0 local _d_w_z=1/(190-1)				for _=1,190 do					Set3D('eye',x,y,z)					task._Wait(1)					_w_x=_w_x+_d_w_x x=(_end_x-_beg_x)/2*sin(_w_x)+((_end_x+_beg_x)/2)					_w_y=_w_y+_d_w_y y=(_end_y-_beg_y)/2*sin(_w_y)+((_end_y+_beg_y)/2)					_w_z=_w_z+_d_w_z if _w_z<0.5 then z=2*(_end_z-_beg_z)*_w_z^2+_beg_z else z=(_end_z-_beg_z)*(-2*_w_z^2+4*_w_z-1)+_beg_z end				end			end		task.Wait(75)		do			local _beg_x=0 local x=_beg_x  local _w_x=-90 local _end_x=-0.70 local _d_w_x=180/(190-1)			local _beg_y=7.40 local y=_beg_y  local _w_y=-90 local _end_y=5.90 local _d_w_y=180/(190-1)			local _beg_z=-11.20 local z=_beg_z local _end_z=-10.60 local _w_z=0 local _d_w_z=1/(190-1)			for _=1,190 do				Set3D('eye',x,y,z)				task._Wait(1)				_w_x=_w_x+_d_w_x x=(_end_x-_beg_x)/2*sin(_w_x)+((_end_x+_beg_x)/2)				_w_y=_w_y+_d_w_y y=(_end_y-_beg_y)/2*sin(_w_y)+((_end_y+_beg_y)/2)				_w_z=_w_z+_d_w_z if _w_z<0.5 then z=2*(_end_z-_beg_z)*_w_z^2+_beg_z else z=(_end_z-_beg_z)*(-2*_w_z^2+4*_w_z-1)+_beg_z end			end		end		task.Wait(75)		do			local _beg_x=-0.70 local x=_beg_x  local _w_x=-90 local _end_x=0.70 local _d_w_x=180/(190-1)			local _beg_y=5.90 local y=_beg_y  local _w_y=-90 local _end_y=5.90 local _d_w_y=180/(190-1)			local _beg_z=-10.60 local z=_beg_z local _end_z=-10.60 local _w_z=0 local _d_w_z=1/(190-1)			for _=1,190 do				Set3D('eye',x,y,z)				task._Wait(1)				_w_x=_w_x+_d_w_x x=(_end_x-_beg_x)/2*sin(_w_x)+((_end_x+_beg_x)/2)				_w_y=_w_y+_d_w_y y=(_end_y-_beg_y)/2*sin(_w_y)+((_end_y+_beg_y)/2)				_w_z=_w_z+_d_w_z if _w_z<0.5 then z=2*(_end_z-_beg_z)*_w_z^2+_beg_z else z=(_end_z-_beg_z)*(-2*_w_z^2+4*_w_z-1)+_beg_z end			end		end		task.Wait(75)		do			local _beg_x=0.70 local x=_beg_x  local _w_x=-90 local _end_x=0.00 local _d_w_x=180/(190-1)			local _beg_y=5.90 local y=_beg_y  local _w_y=-90 local _end_y=4.10 local _d_w_y=180/(190-1)			local _beg_z=-10.60 local z=_beg_z local _end_z=-12.10 local _w_z=0 local _d_w_z=1/(190-1)			for _=1,190 do				Set3D('eye',x,y,z)				task._Wait(1)				_w_x=_w_x+_d_w_x x=(_end_x-_beg_x)/2*sin(_w_x)+((_end_x+_beg_x)/2)				_w_y=_w_y+_d_w_y y=(_end_y-_beg_y)/2*sin(_w_y)+((_end_y+_beg_y)/2)				_w_z=_w_z+_d_w_z if _w_z<0.5 then z=2*(_end_z-_beg_z)*_w_z^2+_beg_z else z=(_end_z-_beg_z)*(-2*_w_z^2+4*_w_z-1)+_beg_z end			end		end		task.Wait(60*17)		do			local _beg_x=0.00 local x=_beg_x  local _w_x=-90 local _end_x=0.00 local _d_w_x=180/(190-1)			local _beg_y=4.10 local y=_beg_y  local _w_y=-90 local _end_y=6.10 local _d_w_y=180/(190-1)			local _beg_z=-12.10 local z=_beg_z local _end_z=-8.90 local _w_z=0 local _d_w_z=1/(190-1)			for _=1,190 do				Set3D('eye',x,y,z)				task._Wait(1)				_w_x=_w_x+_d_w_x x=(_end_x-_beg_x)/2*sin(_w_x)+((_end_x+_beg_x)/2)				_w_y=_w_y+_d_w_y y=(_end_y-_beg_y)/2*sin(_w_y)+((_end_y+_beg_y)/2)				_w_z=_w_z+_d_w_z if _w_z<0.5 then z=2*(_end_z-_beg_z)*_w_z^2+_beg_z else z=(_end_z-_beg_z)*(-2*_w_z^2+4*_w_z-1)+_beg_z end			end		end		task.Wait(340)		do			local _beg_x=0.00 local x=_beg_x  local _w_x=-90 local _end_x=-0.70 local _d_w_x=180/(190-1)			local _beg_y=6.10 local y=_beg_y  local _w_y=-90 local _end_y=5.50 local _d_w_y=180/(190-1)			local _beg_z=-8.90 local z=_beg_z local _end_z=-11.20 local _w_z=0 local _d_w_z=1/(190-1)			for _=1,190 do				Set3D('eye',x,y,z)				task._Wait(1)				_w_x=_w_x+_d_w_x x=(_end_x-_beg_x)/2*sin(_w_x)+((_end_x+_beg_x)/2)				_w_y=_w_y+_d_w_y y=(_end_y-_beg_y)/2*sin(_w_y)+((_end_y+_beg_y)/2)				_w_z=_w_z+_d_w_z if _w_z<0.5 then z=2*(_end_z-_beg_z)*_w_z^2+_beg_z else z=(_end_z-_beg_z)*(-2*_w_z^2+4*_w_z-1)+_beg_z end			end		end		task.Wait(240)		for i = 1, _infinite do			do				local _beg_x=-0.70 local x=_beg_x  local _w_x=-90 local _end_x=0.70 local _d_w_x=180/(190-1)				local _beg_y=5.50 local y=_beg_y  local _w_y=-90 local _end_y=5.50 local _d_w_y=180/(190-1)				local _beg_z=-11.20 local z=_beg_z local _end_z=-11.20 local _w_z=0 local _d_w_z=1/(190-1)				for _=1,190 do					Set3D('eye',x,y,z)					task._Wait(1)					_w_x=_w_x+_d_w_x x=(_end_x-_beg_x)/2*sin(_w_x)+((_end_x+_beg_x)/2)					_w_y=_w_y+_d_w_y y=(_end_y-_beg_y)/2*sin(_w_y)+((_end_y+_beg_y)/2)					_w_z=_w_z+_d_w_z if _w_z<0.5 then z=2*(_end_z-_beg_z)*_w_z^2+_beg_z else z=(_end_z-_beg_z)*(-2*_w_z^2+4*_w_z-1)+_beg_z end				end			end			task.Wait(240)			do				local _beg_x=0.70 local x=_beg_x  local _w_x=-90 local _end_x=-0.70 local _d_w_x=180/(190-1)				local _beg_y=5.50 local y=_beg_y  local _w_y=-90 local _end_y=5.50 local _d_w_y=180/(190-1)				local _beg_z=-11.20 local z=_beg_z local _end_z=-11.20 local _w_z=0 local _d_w_z=1/(190-1)				for _=1,190 do					Set3D('eye',x,y,z)					task._Wait(1)					_w_x=_w_x+_d_w_x x=(_end_x-_beg_x)/2*sin(_w_x)+((_end_x+_beg_x)/2)					_w_y=_w_y+_d_w_y y=(_end_y-_beg_y)/2*sin(_w_y)+((_end_y+_beg_y)/2)					_w_z=_w_z+_d_w_z if _w_z<0.5 then z=2*(_end_z-_beg_z)*_w_z^2+_beg_z else z=(_end_z-_beg_z)*(-2*_w_z^2+4*_w_z-1)+_beg_z end				end			end			task.Wait(240)		end	end)endfunction tkz_stage3_bg:frame()	task.Do(self)	self._z=self._z+self.speedendfunction tkz_stage3_bg:render()	SetViewMode'3d'	background.WarpEffectCapture()	RenderClear(lstg.view3d.fog[3])	for j=-2,10 do		local dz=4*j-math.mod(self._z,4)		Render4V('tkz_stage3_a',0,0,dz+2,-4,0,dz+2,-4,0,dz-2,0,0,dz-2)		Render4V('tkz_stage3_a',0,0,dz+2.5,4,0,dz+2.5,4,0,dz-1.5,0,0,dz-1.5)	end	for j=-2,10 do		local dz=4*j-math.mod(self._z,4)		local Dx=0.2		Render4V('tkz_stage3_b',-2.5,1,dz+2,-0.5,1,dz+2,-0.5,1,dz-2,-2.5,1,dz-2)		Render4V('tkz_stage3_b',2.5-Dx,1,dz+2,0.5-Dx,1,dz+2,0.5-Dx,1,dz-2,2.5-Dx,1,dz-2)	end	for j=-2,10 do		local dz=4*j-math.mod(self._z,4)		local Dx=-0.2		Render4V('tkz_stage3_c',-2.5-Dx,1.5,dz+1.5,-0.5-Dx,1.5,dz+1.5,-0.5-Dx,1.5,dz-2.5,-2.5-Dx,1.5,dz-2.5)		Render4V('tkz_stage3_c',2.5+Dx,1.5,dz+2,0.5+Dx,1.5,dz+1,0.5+Dx,1.5,dz-2,2.5+Dx,1.5,dz-2)	end	SetImageState('tkz_stage3_d','',Color(205+50*sin(self.timer),255,255,255))	for j=-2,10 do		local dz=4*j-math.mod(self._z,4)		Render4V('tkz_stage3_d',-2.5,2,dz+2,-0.5,2,dz+2,-0.5,2,dz-2,-2.5,2,dz-2)		Render4V('tkz_stage3_d',2.5,2,dz+2,0.5,2,dz+1,0.5,2,dz-2,2.5,2,dz-2)	end	SetImageState('tkz_stage3_d','',Color(255,255,255,255))	for j=-2,10 do		local dz=4*j-math.mod(self._z,4)		Render4V('tkz_stage3_d',-3,2.6,dz+2,-1,2.6,dz+2,-1,2.6,dz-2,-3,2.6,dz-2)		Render4V('tkz_stage3_d',3,2.6,dz+1.5,1,2.6,dz+1.5,1,2.6,dz-2.5,3,2.6,dz-2.5)	end	background.WarpEffectApply()	SetViewMode'world'end